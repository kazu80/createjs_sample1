<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Demo 2</title>
    <script src="https://code.createjs.com/createjs-2015.11.26.min.js"></script>
    <script>
        // 読み込みが終わってから初期化
        window.addEventListener ('load', init);

        function init () {
            // 初期化
            const stage = new createjs.Stage ('myCanvas');
            const options = [];
            const particles = [];

            // パーティクル作成
            const particle_count = 20;
            const particle_width = 6;
            const particle_color_fill = 'DarkRed';

            //
            for (let i = 0; i < particle_count; i++) {
                // 円を作成します
                const particle = new createjs.Shape ();
                particle.graphics.beginFill (particle_color_fill); // 赤色で描画するように設定
                particle.graphics.drawCircle (0, 0, particle_width / 2); // 半径 Xpx の円を描画

                // 表示リストに追加
                stage.addChild (particle);

                // パーティクルをキャンバスの枠外下に配置
                particle.x = getRandomInt (particle_width, stage.canvas.width - particle_width);
                particle.y = stage.canvas.height + particle_width;

                // particle instants
                particles[i] = particle;

                // particle options
                options[i] = {
                    centerX: particle.x,
                    angle  : 0,
                    speedX : getRandomArbitary (0.01, 0.05), // 振り幅スピード
                    speedY : -1 * getRandomInt (2, 9), // 上がるスピード
                    range  : getRandomInt (1, 30), // 振り幅
                };
            }

            // 時間経過
            createjs.Ticker.addEventListener ('tick', handleTick);

            /**
             * handleTick
             */
            function handleTick () {
                // パーティクル単体の設定
                for (let i = 0; i < particles.length; i++) {
                    // option
                    const particle = particles[i];
                    const option = options[i];
                    const speedX = option.speedX;
                    const speedY = option.speedY;
                    const range = option.range;

                    // ｘ座標（ゆらゆら）
                    particle.x = option.centerX + Math.sin (option.angle) * range;

                    // y座標（上昇）
                    particle.y += speedY;

                    // Set Math.sin (angle)
                    options[i].angle += speedX;

                    // 画面端に到達時の処理
                    if (particle.y < 0) {
                        // パーティクルをキャンバスの枠外下に配置
                        particle.x = getRandomInt (particle_width, stage.canvas.width - particle_width);
                        particle.y = stage.canvas.height + particle_width;

                        // centerXを初期化
                        options[i].centerX = particle.x;
                    }
                }

                stage.update ();
            }

            // 画面更新の頻度を60FPSに設定
            createjs.Ticker.timingMode = createjs.Ticker.RAF;
            // createjs.Ticker.framerate = 33;
        }

        /**
         * 乱数発生
         * @param min
         * @param max
         * @returns {*}
         */
        function getRandomArbitary (min, max) {
            return Math.random () * (max - min) + min;
        }

        /**
         * 乱数発生（Integer）
         * @param min
         * @param max
         * @returns {*}
         */
        function getRandomInt (min, max) {
            return Math.floor (Math.random () * (max - min + 1)) + min;
        }
    </script>
</head>
<body>
<canvas id="myCanvas" width="640" height="600"></canvas>
</body>
</html>